{"remainingRequest":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\src\\views\\machine\\index.vue?vue&type=style&index=0&lang=scss&","dependencies":[{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\src\\views\\machine\\index.vue","mtime":1688954680000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\css-loader\\dist\\cjs.js","mtime":1688952874000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1688954532000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\postcss-loader\\src\\index.js","mtime":1688953858000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\sass-loader\\dist\\cjs.js","mtime":1688954292000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1688952586000},{"path":"D:\\ws_yutang\\yuTang20230821\\yuTang20230821\\motor-admin-front\\node_modules\\vue-loader\\lib\\index.js","mtime":1688954532000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKDQouZnJvbnQtbWFjaGluZXMgew0KICBwYWRkaW5nOiAyMHB4IDIwcHggNTBweDsNCiAgZGlzcGxheTogZmxleDsNCiAgZmxleC13cmFwOiB3cmFwOw0KICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOw0KDQogIC50b29sLWJhciB7DQogICAgcGFkZGluZzogMTBweCAwIDIwcHg7DQogICAgZGlzcGxheTogZmxleDsNCiAgICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogICAgLmtleXdvcmQtaW5wdXQgew0KICAgICAgd2lkdGg6IDIwMHB4Ow0KICAgIH0NCiAgICAua2V5d29yZC1pbnB1dCwNCiAgICAuZWwtc2VsZWN0LA0KICAgIC5lbC1idXR0b24gew0KICAgICAgbWFyZ2luLXJpZ2h0OiAyMHB4Ow0KICAgIH0NCiAgICAuZWwtc2VsZWN0IHsNCiAgICAgIHdpZHRoOiAxNTBweDsNCiAgICB9DQogIH0NCn0NCg0KLm1hY2hpbmUtdG90YWwgew0KICBwYWRkaW5nLWJvdHRvbTogMTBweDsNCiAgY29sb3I6ICMxZTI5M2I7DQogIC5udW1iZXIgew0KICAgIGNvbG9yOiAjZjU2YzZjOw0KICB9DQp9DQoNCi5lbC10YWJsZSB7DQogIGZsZXg6IDE7DQogIG1pbi1oZWlnaHQ6IDc2MHB4Ow0KICBwYWRkaW5nLWJvdHRvbTogMzBweDsNCn0NCg0KLmVsLXRhYmxlIHRkLA0KLmVsLXRhYmxlIHRoIHsNCiAgcGFkZGluZzogNXB4IDA7DQp9DQoNCi5lbC10YWJsZV9fcm93Lndhcm5pbmctcm93IHRkIHsNCiAgY29sb3I6ICNmZmY7DQogIGJhY2tncm91bmQtY29sb3I6ICNmNTZjNmMgIWltcG9ydGFudDsNCn0NCg0KLnFyLWRpYWxvZyAuZWwtZGlhbG9nX19ib2R5IHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KfQ0KDQouZWwtYnV0dG9uLS1taW5pIHsNCiAgcGFkZGluZzogMnB4IDVweDsNCn0NCg0KQG1lZGlhIHNjcmVlbiBhbmQgKG1heC13aWR0aDogNTAwcHgpIHsNCiAgLnFyLWRpYWxvZyAuZWwtZGlhbG9nIHsNCiAgICB3aWR0aDogMzAwcHggIWltcG9ydGFudDsNCg0KICAgIC5xcmNvZGUtaW1nIHsNCiAgICAgIHdpZHRoOiAxODBweDsNCiAgICB9DQogIH0NCn0NCg0KLmJ0bi1yb3cgLmVsLWJ1dHRvbiB7DQogIHRleHQtYWxpZ246IGNlbnRlcjsNCiAgbWFyZ2luOiAwIDEwcHggIWltcG9ydGFudDsNCn0NCg0KLm1hY2hpbmUtZm9ybSB7DQogIC5lbC1mb3JtLWl0ZW0gew0KICAgIG1hcmdpbi1ib3R0b206IDAgIWltcG9ydGFudDsNCiAgfQ0KICAuZXhwcm90IHsNCiAgICBwYWRkaW5nLXRvcDogMjBweDsNCiAgfQ0KfQ0KDQoubWFuYWdlci1yb3cgew0KICBkaXNwbGF5OiBmbGV4Ow0KICAubWFuYWdlci1pdGVtIHsNCiAgICBtYXJnaW4tbGVmdDogNTBweDsNCiAgfQ0KfQ0KDQouZGl2aWRlci10aXRsZSB7DQogIGgyIHsNCiAgICBsaW5lLWhlaWdodDogMjRweDsNCiAgICBmb250LXNpemU6IDE4cHg7DQogICAgZm9udC13ZWlnaHQ6IG5vcm1hbDsNCiAgICBjb2xvcjogIzAwMDsNCiAgfQ0KfQ0KLm1hY2hpbmUtZGlhbG9nIHsNCiAgLmVsLWRpYWxvZ19fYm9keSB7DQogICAgcGFkZGluZzogMCAyMHB4IDMwcHg7DQogIH0NCn0NCg=="},{"version":3,"sources":["index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAw4BA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/machine","sourcesContent":["<template>\r\n  <div class=\"front-machines\">\r\n    <div class=\"tool-bar\">\r\n      <div class=\"search-row\">\r\n        <el-input\r\n          class=\"keyword-input\"\r\n          placeholder=\"请输入ID/设备名称\"\r\n          clearable\r\n          v-model=\"keyword\"\r\n        ></el-input>\r\n        <el-input\r\n          class=\"keyword-input\"\r\n          placeholder=\"请输入微信名/微信名\"\r\n          clearable\r\n          v-model=\"searchName\"\r\n        ></el-input>\r\n        <template>\r\n          <el-select v-model=\"stat\" clearable placeholder=\"请选择产品状态\">\r\n            <el-option\r\n              v-for=\"item in statOptions\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            >\r\n            </el-option>\r\n          </el-select>\r\n        </template>\r\n        <template>\r\n          <el-select\r\n            v-model=\"machine_type\"\r\n            clearable\r\n            placeholder=\"请选择设备类型\"\r\n          >\r\n            <el-option\r\n              v-for=\"item in machineTypes\"\r\n              :key=\"item.value\"\r\n              :label=\"item.label\"\r\n              :value=\"item.value\"\r\n            >\r\n            </el-option>\r\n          </el-select>\r\n        </template>\r\n        <template>\r\n          <el-date-picker\r\n            v-model=\"endBindDate\"\r\n            type=\"date\"\r\n            value-format=\"yyyy-MM-dd\"\r\n            placeholder=\"请选择设备有效期\"\r\n          >\r\n          </el-date-picker>\r\n        </template>\r\n      </div>\r\n\r\n      <div class=\"btn-row\">\r\n        <el-button type=\"primary\" class=\"search-btn\" @click=\"fetchData\"\r\n          >搜索</el-button\r\n        >\r\n        <el-button type=\"warn\" class=\"rest-btn\" @click=\"handleReset\"\r\n          >重置</el-button\r\n        >\r\n      </div>\r\n    </div>\r\n    <div class=\"machine-total\">\r\n      <span>设备数量：</span>\r\n      <span class=\"number\">{{ total }}</span>\r\n    </div>\r\n    <template>\r\n      <el-table\r\n        :data=\"machines\"\r\n        tooltip-effect=\"dark\"\r\n        border\r\n        style=\"width: 100%\"\r\n        stripe\r\n        :row-class-name=\"tableRowClassName\"\r\n      >\r\n        <!-- <el-table :data=\"machines\" tooltip-effect=\"dark\" border style=\"width: 100%\" @selection-change=\"handleSelectionChange\"> -->\r\n        <!-- <el-table-column\r\n          type=\"selection\"\r\n         align=\"center\"\r\n          width=\"30\">\r\n        </el-table-column>         -->\r\n        <el-table-column\r\n          prop=\"machine_code\"\r\n          align=\"center\"\r\n          label=\"设备ID\"\r\n          width=\"84px\"\r\n        />\r\n        <el-table-column prop=\"machine_name\" align=\"center\" label=\"设备名称\" />\r\n        <!-- <el-table-column prop=\"machine_code\" align=\"center\" label=\"物理设备码\">\r\n        </el-table-column> -->\r\n        <el-table-column prop=\"IMEI\" align=\"center\" label=\"IMEI\" />\r\n        <el-table-column\r\n          prop=\"ICCID\"\r\n          align=\"center\"\r\n          label=\"ICCID\"\r\n          width=\"178\"\r\n        />\r\n\r\n        <el-table-column align=\"center\" label=\"设备类型\">\r\n          <template slot-scope=\"scope\">\r\n            <span>{{ setMachineType(scope.row) }}</span>\r\n          </template>\r\n        </el-table-column>\r\n        <!-- <el-table-column prop=\"create_time\" align=\"center\" label=\"创建时间\">\r\n        </el-table-column> -->\r\n        <!-- <el-table-column prop=\"over_time\" align=\"center\" label=\"服务到期时间\">\r\n        </el-table-column> -->\r\n\r\n        <!-- <el-table-column prop=\"first_bind_time\" label=\"首次绑定时间\" align=\"center\"> </el-table-column> -->\r\n        <!-- <el-table-column prop=\"end_bind_date\" label=\"计费结束时间\" align=\"center\"> </el-table-column> -->\r\n        <!-- <el-table-column prop=\"online_count\" label=\"累计在线时长\" align=\"center\"> </el-table-column> -->\r\n        <!-- <el-table-column prop=\"electric_count\" label=\"累计用电\" align=\"center\"> </el-table-column> -->\r\n        <el-table-column label=\"产品状态\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            {{ setStatusTxt(scope.row.stat) }}\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column prop=\"over_date\" label=\"设备有效期\" align=\"center\" />\r\n        <el-table-column\r\n          prop=\"end_bind_date\"\r\n          label=\"服务有效期\"\r\n          align=\"center\"\r\n        />\r\n\r\n        <el-table-column label=\"在线状态\" align=\"center\" width=\"80\">\r\n          <template slot-scope=\"scope\">\r\n            {{ scope.row.is_online == 1 ? \"在线\" : \"离线\" }}\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <el-table-column label=\"上线时间\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n            {{\r\n              scope.row.is_online == 1\r\n                ? scope.row.online_time\r\n                : scope.row.offline_time\r\n            }}\r\n          </template>\r\n        </el-table-column>\r\n\r\n        <!-- <el-table-column label=\"设备状态\" align=\"center\">\r\n          <template slot-scope=\"scope\">\r\n              {{setMachineStatus(scope.row)}}\r\n          </template>\r\n        </el-table-column> -->\r\n        <el-table-column prop=\"username\" label=\"微信名\" align=\"center\" />\r\n        <el-table-column prop=\"remark\" label=\"备注名\" align=\"center\" />\r\n\r\n        <el-table-column align=\"center\" label=\"操作\" class=\"deal-column\">\r\n          <template slot-scope=\"scope\">\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              @click=\"editMachineType(scope.row)\"\r\n              >编辑</el-button\r\n            >\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              @click=\"editMachineStatus(scope.row)\"\r\n              >出库</el-button\r\n            >\r\n            <el-button type=\"primary\" size=\"mini\" @click=\"checkCode(scope.row)\"\r\n              >二维码</el-button\r\n            >\r\n            <el-button\r\n              type=\"primary\"\r\n              size=\"mini\"\r\n              :disabled=\"checkMachineDisable\"\r\n              @click=\"checkMachineData(scope.row)\"\r\n              >设备数据</el-button\r\n            >\r\n\r\n            <el-button type=\"default\" size=\"mini\" @click=\"goToLogs(scope.row)\"\r\n              >操作日志</el-button\r\n            >\r\n            <el-button type=\"danger\" size=\"mini\" @click=\"delMachine(scope.row)\"\r\n              >删除</el-button\r\n            >\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n      <el-pagination\r\n        background\r\n        layout=\"prev, pager, next\"\r\n        :page-size=\"20\"\r\n        :current-page=\"pageIndex\"\r\n        @current-change=\"handleCurrentChange\"\r\n        :total=\"total\"\r\n      >\r\n      </el-pagination>\r\n    </template>\r\n\r\n    <el-dialog title=\"修改设备类型\" :visible.sync=\"typeVisible\" width=\"700px\">\r\n      <el-form\r\n        label-position=\"left\"\r\n        label-width=\"140px\"\r\n        ref=\"editForm\"\r\n        :model=\"editForm\"\r\n        :rules=\"editRules\"\r\n      >\r\n        <el-form-item label=\"名称：\">\r\n          <span>{{ currentMachine.machine_name }}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"类型：\">\r\n          <el-radio-group v-model=\"editForm.machineType\">\r\n            <el-radio\r\n              v-for=\"(item, index) of machineTypes\"\r\n              :key=\"index\"\r\n              :label=\"item.value\"\r\n            >\r\n              {{ item.label }}\r\n            </el-radio>\r\n          </el-radio-group>\r\n        </el-form-item>\r\n        <el-form-item label=\"设备有效期：\" prop=\"over_date\">\r\n          <el-date-picker\r\n            v-model=\"editForm.over_date\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"\r\n          >\r\n          </el-date-picker>\r\n        </el-form-item>\r\n\r\n        <el-form-item label=\"服务有效期：\" prop=\"end_bind_date\">\r\n          <el-date-picker\r\n            v-model=\"editForm.end_bind_date\"\r\n            type=\"date\"\r\n            placeholder=\"选择日期\"\r\n          >\r\n          </el-date-picker>\r\n        </el-form-item>\r\n        <el-form-item label=\"备注名\">\r\n          <el-input v-model=\"editForm.remark\" style=\"width:220px;\" />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"typeVisible = false\">取 消</el-button>\r\n        <el-button type=\"primary\" @click=\"submitType('editForm')\"\r\n          >确 定</el-button\r\n        >\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"录入物流信息\" :visible.sync=\"statusVisible\" width=\"680px\">\r\n      <el-form\r\n        ref=\"productionForm\"\r\n        label-position=\"left\"\r\n        label-width=\"140px\"\r\n        :model=\"productionForm\"\r\n        :rules=\"rules\"\r\n      >\r\n        <el-form-item label=\"设备名称：\">\r\n          <span>{{ currentMachine.machine_name }}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"选择快递：\" prop=\"express_name\">\r\n          <!-- <el-input v-model=\"productionForm.express_name\" prop=\"express_name\" placeholder=\"请输入快递单号\" /> -->\r\n          <el-select\r\n            v-model=\"productionForm.express_name\"\r\n            placeholder=\"请选择快递\"\r\n          >\r\n            <el-option\r\n              v-for=\"item of delivery\"\r\n              :key=\"item.id\"\r\n              :label=\"item.name\"\r\n              :value=\"item.name\"\r\n            />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"快递单号：\" prop=\"express_no\">\r\n          <el-input\r\n            v-model=\"productionForm.express_no\"\r\n            :disabled=\"productionForm.express_name === ''\"\r\n            placeholder=\"请输入快递单号\"\r\n          />\r\n        </el-form-item>\r\n      </el-form>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"statusVisible = false\">取 消</el-button>\r\n        <el-button\r\n          type=\"primary\"\r\n          v-loading=\"statusLoading\"\r\n          :disabled=\"statusLoading\"\r\n          @click=\"submitStatus('productionForm')\"\r\n          >确 定</el-button\r\n        >\r\n      </span>\r\n    </el-dialog>\r\n\r\n    <el-dialog title=\"物流信息\" :visible.sync=\"checkVisible\" width=\"680px\">\r\n      <el-form\r\n        ref=\"productionForm\"\r\n        label-position=\"left\"\r\n        label-width=\"140px\"\r\n        :model=\"productionForm\"\r\n      >\r\n        <el-form-item label=\"设备名称：\">\r\n          <span>{{ currentMachine.machine_name }}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"选择快递：\">\r\n          <span>{{ productionForm.express_name }}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"快递单号：\">\r\n          <span>{{ productionForm.express_no }}</span>\r\n        </el-form-item>\r\n      </el-form>\r\n    </el-dialog>\r\n\r\n    <el-dialog\r\n      title=\"二维码\"\r\n      :visible.sync=\"qrVisible\"\r\n      class=\"qr-dialog\"\r\n      width=\"500px\"\r\n    >\r\n      <img class=\"qrcode-img\" :src=\"qr_code\" alt=\"\" />\r\n    </el-dialog>\r\n\r\n    <el-dialog\r\n      class=\"machine-dialog\"\r\n      title=\"设备数据\"\r\n      :visible.sync=\"machineVisible\"\r\n      width=\"400px\"\r\n    >\r\n      <el-form class=\"machine-form\" label-position=\"left\" label-width=\"90px\">\r\n        <el-form-item label=\"设备名称：\">\r\n          <span>{{ machineDetail.machine_name }}</span>\r\n        </el-form-item>\r\n        <el-form-item label=\"设备ID：\">\r\n          <span>{{ machineDetail.machine_code }}</span>\r\n        </el-form-item>\r\n        <!-- 增氧机 -->\r\n        <template v-if=\"machineDetail.machine_type == 1\">\r\n          <div class=\"manager-row\">\r\n            <el-form-item label=\"塘主：\">\r\n              <span>{{ machineDetail.username || \"无\" }}</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"管理者：\" class=\"manager-item\">\r\n              <span>{{ machineDetail.manager || \"无\" }}</span>\r\n            </el-form-item>\r\n          </div>\r\n\r\n          <el-form-item label=\"状态：\">\r\n            <el-tag\r\n              size=\"mini\"\r\n              type=\"success\"\r\n              effect=\"dark\"\r\n              v-if=\"machineDetail.is_online == 1\"\r\n              >在线</el-tag\r\n            >\r\n            <el-tag type=\"info\" size=\"mini\" effect=\"dark\" v-else>离线</el-tag>\r\n          </el-form-item>\r\n        </template>\r\n\r\n        <!-- 测氧仪/PH检测仪 -->\r\n        <template\r\n          v-if=\"\r\n            machineDetail.machine_type == 4 || machineDetail.machine_type == 5\r\n          \"\r\n        >\r\n          <el-form-item label=\"温度：\">\r\n            <span>{{ machineDetail.degree || 0 }} °C</span>\r\n          </el-form-item>\r\n          <el-form-item label=\"溶氧值：\">\r\n            <span>{{ machineDetail.oxygen || 0 }} mg/L</span>\r\n          </el-form-item>\r\n        </template>\r\n        <!-- 其他电机类设备 -->\r\n        <template v-else>\r\n          <div\r\n            v-if=\"\r\n              (machineDetail.is_online == 1 &&\r\n                machineDetail.machine_type == 1) ||\r\n                machineDetail.machine_type != 1\r\n            \"\r\n          >\r\n            <el-form-item label=\"转速：\">\r\n              <span>{{ machineDetail.speed || 0 }} RPM</span>\r\n            </el-form-item>\r\n            <el-form-item label=\"功率：\">\r\n              <span\r\n                >{{\r\n                  machineDetail.power ? machineDetail.power * 0.001 : 0\r\n                }}\r\n                kW</span\r\n              >\r\n            </el-form-item>\r\n          </div>\r\n        </template>\r\n\r\n        <!-- 增氧机 -->\r\n        <template v-if=\"machineDetail.machine_type == 1\">\r\n          <el-form-item label=\"累计时长：\">\r\n            <span>{{ machineDetail.online_count || 0 }} H</span>\r\n          </el-form-item>\r\n          <div class=\"divider-title\">\r\n            <h2>本月用电</h2>\r\n          </div>\r\n          <el-form-item label=\"累计用电：\">\r\n            <span\r\n              >{{\r\n                machineDetail.electric_count\r\n                  ? (machineDetail.electric_count / 10).toFixed(2)\r\n                  : 0\r\n              }}\r\n              KWH</span\r\n            >\r\n          </el-form-item>\r\n          <div class=\"exprot\">\r\n            <el-button\r\n              type=\"primary\"\r\n              @click=\"handleExportElectr\"\r\n              v-loading=\"exportLoading\"\r\n              >导出月度用电数据</el-button\r\n            >\r\n          </div>\r\n        </template>\r\n\r\n        <!-- 测氧仪 -->\r\n        <template v-if=\"machineDetail.machine_type == 4\">\r\n          <div class=\"exprot\">\r\n            <el-button\r\n              type=\"primary\"\r\n              @click=\"handleExportLog\"\r\n              v-loading=\"exportLoading\"\r\n              >导出7天用电数据</el-button\r\n            >\r\n          </div>\r\n        </template>\r\n      </el-form>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getMachines,\r\n  changeMachineType,\r\n  handleShip,\r\n  deleteMachine,\r\n  getMachineDetail,\r\n  getOxyElectric,\r\n  getOxyLog\r\n} from \"@/api/machine\";\r\nimport constants from \"@/utils/constants\";\r\n\r\nexport default {\r\n  name: \"MachineManage\",\r\n  data() {\r\n    return {\r\n      loading: false,\r\n      pageIndex: 1,\r\n      machines: [],\r\n      machineTypes: Object.freeze([\r\n        {\r\n          value: 0,\r\n          label: \"无\"\r\n        },\r\n        {\r\n          value: 1,\r\n          label: \"增氧\"\r\n        },\r\n        {\r\n          value: 2,\r\n          label: \"投料\"\r\n        },\r\n        {\r\n          value: 3,\r\n          label: \"风扇\"\r\n        },\r\n        {\r\n          value: 4,\r\n          label: \"测氧仪\"\r\n        },\r\n        {\r\n          value: 5,\r\n          label: \"PH检测仪\"\r\n        }\r\n      ]),\r\n      multipleSelection: [],\r\n      typeVisible: false,\r\n      currentMachine: {},\r\n      editForm: {\r\n        machineType: 1,\r\n        over_date: \"\",\r\n        end_bind_date: \"\",\r\n        remark: \"\"\r\n      },\r\n      editRules: {\r\n        over_date: [\r\n          {\r\n            // type: \"date\",\r\n            required: true,\r\n            message: \"请选择设备有效期\",\r\n            trigger: \"change\"\r\n          }\r\n        ],\r\n        end_bind_date: [\r\n          {\r\n            // type: \"date\",\r\n            required: true,\r\n            message: \"请选择服务有效期\",\r\n            trigger: \"change\"\r\n          }\r\n        ]\r\n      },\r\n      qr_code: \"\",\r\n      qrVisible: false,\r\n      statusVisible: false,\r\n      checkVisible: false,\r\n\r\n      delivery: Object.freeze(constants.delivery),\r\n      productionForm: {\r\n        express_name: \"\",\r\n        express_no: \"\"\r\n      },\r\n      rules: {\r\n        express_name: [\r\n          // { required: true, trigger: 'change', validator: checkExpressName }\r\n          {\r\n            required: true,\r\n            trigger: \"change\",\r\n            message: \"请选择快递\"\r\n          }\r\n        ],\r\n        express_no: [\r\n          // { required: true, trigger: 'blur', validator: checkExpressNo }\r\n          {\r\n            required: true,\r\n            trigger: \"blur\",\r\n            message: \"请输入快递单号\"\r\n          }\r\n        ]\r\n      },\r\n      statusLoading: false,\r\n      total: 0,\r\n\r\n      machineVisible: false,\r\n      keyword: \"\",\r\n      searchName: \"\",\r\n      stat: \"\",\r\n      statOptions: [\r\n        {\r\n          label: \"生产\",\r\n          value: \"0\"\r\n        },\r\n        {\r\n          label: \"入库\",\r\n          value: \"1\"\r\n        },\r\n        {\r\n          label: \"出库\",\r\n          value: \"2\"\r\n        },\r\n        {\r\n          label: \"客户建档\",\r\n          value: \"3\"\r\n        }\r\n      ],\r\n      endBindDate: \"\",\r\n      machine_type: \"\",\r\n      machineDetail: {},\r\n      electric: [],\r\n      oxyLog: [],\r\n      exportLoading: false,\r\n      checkMachineDisable: false\r\n    };\r\n  },\r\n  watch: {},\r\n  mounted() {\r\n    this.fetchData();\r\n  },\r\n  methods: {\r\n    setStatusTxt(status) {\r\n      const math = this.statOptions.find(x => {\r\n        return x.value == status;\r\n      });\r\n      return math ? math.label : \"无\";\r\n    },\r\n    handleReset() {\r\n      this.machine_type = \"\";\r\n      this.stat = \"\";\r\n      this.keyword = \"\";\r\n      this.searchName = \"\";\r\n      this.fetchData();\r\n    },\r\n\r\n    fetchData() {\r\n      this.loading = true;\r\n      const params = {\r\n        page: this.pageIndex,\r\n        stat: this.stat,\r\n        machine_type: this.machine_type,\r\n        keyword: this.keyword,\r\n        name: this.searchName,\r\n        over_date: this.endBindDate\r\n      };\r\n      getMachines(params).then(res => {\r\n        this.machines = res.data;\r\n        this.total = res.count;\r\n        this.loading = false;\r\n      });\r\n    },\r\n    handleCurrentChange(index) {\r\n      this.pageIndex = index;\r\n      this.fetchData();\r\n    },\r\n    setMachineStatus(item) {\r\n      return item.is_online == 0\r\n        ? \"离线\"\r\n        : item.status == 1\r\n        ? \"运行\"\r\n        : item.status == 2\r\n        ? \"停机\"\r\n        : \"故障\";\r\n    },\r\n    setMachineType(item) {\r\n      return this.machineTypes.find(x => x.value === item.machine_type)?.label;\r\n    },\r\n\r\n    handleSelectionChange(val) {\r\n      this.multipleSelection = val;\r\n    },\r\n    editMachineType(machine) {\r\n      this.currentMachine = machine;\r\n      this.editForm.machineType = machine.machine_type;\r\n      this.editForm.over_date = machine.over_date;\r\n      this.editForm.end_bind_date = machine.end_bind_date;\r\n      this.editForm.remark = machine.remark;\r\n\r\n      this.typeVisible = true;\r\n    },\r\n    submitType(formName) {\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          changeMachineType({\r\n            id: this.currentMachine.id,\r\n            machine_type: this.editForm.machineType,\r\n            over_date: this.editForm.over_date,\r\n            end_bind_date: this.editForm.end_bind_date,\r\n            remark: this.editForm.remark\r\n          })\r\n            .then(res => {\r\n              this.fetchData();\r\n              this.typeVisible = false;\r\n            })\r\n            .catch(_ => {\r\n              this.typeVisible = false;\r\n            });\r\n        } else {\r\n          console.log(\"error submit!!\");\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n    checkCode(machine) {\r\n      if (!machine.qr_code) {\r\n        this.$message.warning(\"没有二维码\");\r\n        return;\r\n      }\r\n      this.qr_code = machine.qr_code;\r\n      this.qrVisible = true;\r\n    },\r\n    async checkMachineData(machine) {\r\n      this.checkMachineDisable = true;\r\n      this.currentMachine = machine;\r\n      try {\r\n        // 用电记录\r\n        if (machine.machine_type == 1) {\r\n          const resElectric = await getOxyElectric({ id: machine.id });\r\n          this.electric = resElectric.data && resElectric.data.reverse();\r\n          console.log(resElectric.data);\r\n        } else if (machine.machine_type == 4) {\r\n          // 测氧仪历史记录\r\n          const resLog = await getOxyLog({ id: machine.id });\r\n          this.oxyLog = resLog.data;\r\n          console.log(resLog.data);\r\n        }\r\n\r\n        //   获取设备详情数据\r\n        // 2021-8-16 增加下面设备详情接口，currentMachine和machineDetail,都包含部分设备数据\r\n        const res = await getMachineDetail({ id: machine.id });\r\n        this.machineDetail = res.data;\r\n        console.log(res.data);\r\n\r\n        this.machineVisible = true;\r\n        this.checkMachineDisable = false;\r\n      } catch (error) {\r\n        this.checkMachineDisable = false;\r\n      }\r\n    },\r\n    tableRowClassName({ row, rowIndex }) {\r\n      if (row.machine_type === 0) {\r\n        return \"warning-row\";\r\n      }\r\n      return \"\";\r\n    },\r\n    editMachineStatus(machine) {\r\n      this.currentMachine = machine;\r\n      this.productionForm.express_name = machine.express_name;\r\n      this.productionForm.express_no = machine.express_no;\r\n      if (machine.express_name) {\r\n        // this.$message.warning('设备的物流信息已录入，无法更改')\r\n        // return;\r\n        this.checkVisible = true;\r\n      } else {\r\n        this.statusVisible = true;\r\n      }\r\n    },\r\n    submitStatus(formName) {\r\n      // console.log(this.productionForm);\r\n      this.statusLoading = true;\r\n      this.$refs[formName].validate(valid => {\r\n        if (valid) {\r\n          handleShip({\r\n            id: this.currentMachine.id,\r\n            express_name: this.productionForm.express_name,\r\n            express_no: this.productionForm.express_no\r\n          })\r\n            .then(res => {\r\n              this.$message.success(\"操作成功\");\r\n              this.statusVisible = false;\r\n              this.statusLoading = false;\r\n              this.fetchData();\r\n            })\r\n            .catch(_ => {\r\n              this.statusLoading = false;\r\n\r\n              this.statusVisible = false;\r\n            });\r\n        } else {\r\n          // console.log(\"error submit!!\");\r\n          this.statusLoading = false;\r\n\r\n          return false;\r\n        }\r\n      });\r\n    },\r\n\r\n    goToLogs(machine) {\r\n      this.$router.push({ name: \"MachineLog\", params: { id: machine.id } });\r\n    },\r\n    delMachine(machine) {\r\n      this.$confirm(\r\n        \"此操作删除的数据不可恢复，请谨慎操作！\",\r\n        \"删除设备所有数据\",\r\n        {\r\n          distinguishCancelAndClose: true,\r\n          confirmButtonText: \"确定删除\",\r\n          cancelButtonText: \"放弃\"\r\n        }\r\n      )\r\n        .then(() => {\r\n          this.sureDeleteMachine(machine);\r\n        })\r\n        .catch(action => {\r\n          this.$message({\r\n            type: \"info\",\r\n            message: \"您已放弃删除\"\r\n          });\r\n        });\r\n    },\r\n    sureDeleteMachine(machine) {\r\n      deleteMachine({ id: machine.id })\r\n        .then(res => {\r\n          this.fetchData();\r\n          this.$message.success(\"删除成功\");\r\n        })\r\n        .catch(_ => {\r\n          this.$message.error(\"删除失败\");\r\n        });\r\n    },\r\n    formatJson(filterVal, jsonData) {\r\n      return jsonData.map(v => filterVal.map(j => v[j]));\r\n    },\r\n    handleExportElectr() {\r\n      if (this.electric && this.electric.length == 0) {\r\n        this.$message.error(\"没有记录到此设备的用电量数据\");\r\n        return;\r\n      }\r\n      this.exportLoading = true;\r\n      import(\"@/utils/Export2Excel\").then(excel => {\r\n        const tHeader = [\"转多多增氧机月度用电汇总\", \"\", \"\"];\r\n        const pond_title = this.currentMachine.pond_title\r\n          ? this.currentMachine.pond_title\r\n          : \"无\";\r\n        let data = [\r\n          [\"鱼塘名称\", pond_title, \"\"],\r\n          [\"塘主名字\", this.machineDetail.username, \"\"],\r\n          [\"增氧机编号\", this.machineDetail.machine_code, \"\"],\r\n          [\"总时长\", this.machineDetail.online_count, \"\"],\r\n          //   [\"总用电量\", this.machineDetail.electric_count, \"\"],\r\n          [\r\n            \"总用电量\",\r\n            this.machineDetail.electric_count\r\n              ? (this.machineDetail.electric_count / 10).toFixed(2)\r\n              : 0,\r\n            \"\"\r\n          ],\r\n          [\"数据\", \"时间\", \"kwh\"]\r\n        ];\r\n\r\n        this.electric.forEach((oneMonth, inx) => {\r\n          data.push([\r\n            inx === 0 ? \"月度用电\" : inx + 1,\r\n            oneMonth.date,\r\n            (oneMonth.electric / 10).toFixed(2)\r\n          ]);\r\n        });\r\n\r\n        // 合并单元格\r\n        // const merges = [\"A1:C1\", \"B2:C2\", \"B3:C3\", \"B4:C4\", \"B5:C5\", \"B6:C6\"];\r\n        const merges = [\"A1:C1\"];\r\n        console.log(data);\r\n\r\n        excel.export_json_to_excel({\r\n          header: tHeader,\r\n          data,\r\n          filename:\r\n            \"转多多增氧机-\" +\r\n            this.machineDetail.machine_name +\r\n            \"-\" +\r\n            this.machineDetail.machine_code +\r\n            \"-\" +\r\n            \"月度用电汇总\",\r\n          merges,\r\n          autoWidth: false,\r\n          bookType: \"xlsx\"\r\n        });\r\n        this.exportLoading = false;\r\n      });\r\n    },\r\n    handleExportLog() {\r\n      this.exportLoading = true;\r\n      import(\"@/utils/Export2Excel\").then(excel => {\r\n        const tHeader = [\"转多多测氧仪数据\", \"\", \"\", \"\"];\r\n        const pond_title = this.currentMachine.pond_title\r\n          ? this.currentMachine.pond_title\r\n          : \"无\";\r\n\r\n        let data = [\r\n          [\"鱼塘名称\", pond_title, \"\", \"\"],\r\n          [\r\n            \"塘主名字\",\r\n            this.machineDetail.username ? this.machineDetail.username : \"\",\r\n            \"\",\r\n            \"\"\r\n          ],\r\n          [\"测氧仪编号\", this.machineDetail.machine_code, \"\", \"\"],\r\n          [\"数据\", \"时间\", \"含氧量\", \"温度值\"]\r\n        ];\r\n\r\n        const res = this.oxyLog.result;\r\n        let count = 0;\r\n        for (let key in res) {\r\n          if (Object.hasOwnProperty.call(res, key)) {\r\n            const val = res[key];\r\n            const oxyLength = val.oxygen.length;\r\n            for (let i = 0; i < oxyLength; i++) {\r\n              const oneOxy = val.oxygen[i];\r\n              const pie = parseInt(60 / oneOxy.length);\r\n              for (let j = 0; j < oneOxy.length; j++) {\r\n                const oneHourOxy = oneOxy[j];\r\n                const currentClock = parseInt(j * pie);\r\n                const minu =\r\n                  currentClock < 10 ? \"0\" + currentClock : currentClock;\r\n                count++;\r\n                data.push([\r\n                  count,\r\n                  `${key} ${val.hours[i]}:${minu}`,\r\n                  `${oneHourOxy}`,\r\n                  `${val.degrees[i][j]}`\r\n                ]);\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        // 合并单元格\r\n        const merges = [\"A1:D1\"];\r\n        // const merges = [\"A1:D1\", \"B2:D2\", \"B3:D3\", \"B4:D4\"];\r\n\r\n        excel.export_json_to_excel({\r\n          header: tHeader,\r\n          data,\r\n          filename:\r\n            \"转多多测氧仪-\" +\r\n            this.machineDetail.machine_name +\r\n            \"-\" +\r\n            this.machineDetail.machine_code +\r\n            \"-\" +\r\n            \"用电记录\",\r\n          merges,\r\n          autoWidth: false,\r\n          bookType: \"xlsx\"\r\n        });\r\n        this.exportLoading = false;\r\n      });\r\n    }\r\n  }\r\n};\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n.front-machines {\r\n  padding: 20px 20px 50px;\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  flex-direction: column;\r\n\r\n  .tool-bar {\r\n    padding: 10px 0 20px;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    .keyword-input {\r\n      width: 200px;\r\n    }\r\n    .keyword-input,\r\n    .el-select,\r\n    .el-button {\r\n      margin-right: 20px;\r\n    }\r\n    .el-select {\r\n      width: 150px;\r\n    }\r\n  }\r\n}\r\n\r\n.machine-total {\r\n  padding-bottom: 10px;\r\n  color: #1e293b;\r\n  .number {\r\n    color: #f56c6c;\r\n  }\r\n}\r\n\r\n.el-table {\r\n  flex: 1;\r\n  min-height: 760px;\r\n  padding-bottom: 30px;\r\n}\r\n\r\n.el-table td,\r\n.el-table th {\r\n  padding: 5px 0;\r\n}\r\n\r\n.el-table__row.warning-row td {\r\n  color: #fff;\r\n  background-color: #f56c6c !important;\r\n}\r\n\r\n.qr-dialog .el-dialog__body {\r\n  text-align: center;\r\n}\r\n\r\n.el-button--mini {\r\n  padding: 2px 5px;\r\n}\r\n\r\n@media screen and (max-width: 500px) {\r\n  .qr-dialog .el-dialog {\r\n    width: 300px !important;\r\n\r\n    .qrcode-img {\r\n      width: 180px;\r\n    }\r\n  }\r\n}\r\n\r\n.btn-row .el-button {\r\n  text-align: center;\r\n  margin: 0 10px !important;\r\n}\r\n\r\n.machine-form {\r\n  .el-form-item {\r\n    margin-bottom: 0 !important;\r\n  }\r\n  .exprot {\r\n    padding-top: 20px;\r\n  }\r\n}\r\n\r\n.manager-row {\r\n  display: flex;\r\n  .manager-item {\r\n    margin-left: 50px;\r\n  }\r\n}\r\n\r\n.divider-title {\r\n  h2 {\r\n    line-height: 24px;\r\n    font-size: 18px;\r\n    font-weight: normal;\r\n    color: #000;\r\n  }\r\n}\r\n.machine-dialog {\r\n  .el-dialog__body {\r\n    padding: 0 20px 30px;\r\n  }\r\n}\r\n</style>\r\n"]}]}